<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UVA RDS - Journals by Discipline</title>

  {% load static %}

  <!-- MDB icon -->
  <link rel="icon" href="{% static 'app/img/uva_logo.png' %}" type="image/x-icon">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="{% static 'app/css/bootstrap.min.css' %}">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="{% static 'app/css/mdb.min.css' %}">
  <!-- MDBootstrap Datatables  -->
  <link rel="stylesheet" href="{% static 'app/css/addons/datatables.min.css' %}">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="{% static 'app/css/style.css' %}">
  <link rel="stylesheet" href="{% static 'app/css/jquery.typeahead.min.css' %}">

  <style type="text/css">
    #breadcrumb a {
      color: #E57200;
    }

    hr {
      margin-bottom: 0;
    }

    small {
      font-size: 0.7em;
    }
    
  </style>
</head>
<body>

  <!--Navbar-->
  <nav class="navbar navbar-dark" style="background-color: #232d4b;">
    <a class="navbar-brand" href="{% url 'app:index' %}">
      <img src="{% static 'app/img/uva_library_logo.svg' %} " height="30" alt="UVA Library">
    </a>
    {% if user.is_authenticated %}
        <a class="btn btn-sm my-2 my-sm-0 rounded text-white" href="{% url 'app:logout' %}" style="background-color: #E57200">Logout</a>
    {% else %}
        <a class="btn btn-sm my-2 my-sm-0 rounded text-white" href="{% url 'app:login' %}" style="background-color: #E57200">Login</a>
    {% endif %}
  </nav>
  <!-- Navbar -->

  <main>
    <div class="container-fluid" id="breadcrumb_container">
      <div class="row pt-3" style="background-color: #141e3c">
        <p class="ml-4 text-white"><a href="{% url 'app:tools' %}" style="color: #E57200">All Tools</a>  <i class="fas fa-chevron-right mx-2" style="font-size:12px;"></i> Journals by Discipline</p>
      </div>
    </div>
    
    <div class="container my-5" id="title_description">
      <h3 class="mb-4">Journals by Discipline Tool</h3>
      <p>Descriptions and important notes</p>
      <p style="display: hidden;" id="downloads-checked"></p>
      <p style="display: hidden;" id="recent-checked"></p>
      <p style="display: hidden;" id="alltime-checked"></p>
      <p style="display: hidden;" id="publications-checked"></p>
      <p style="display: hidden;" id="citations-checked"></p>
    </div>

    <hr class="orange lighten-4">

    <div class="container-fluid" id="metrics_data">
      <div class="row">
        <div class="col-md-3 pt-3 border-right grey lighten-5" id="metrics_column">
          <div class="ml-2"> <!-- Use position-fixed class to fix the left column -->
            <h4 class="mb-4">Disciplines</h4>

            <select class="browser-default custom-select mb-2" id="discipline_select">
              <option>Select Discipline</option>
            </select>

            <div class="modal fade " id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Find Discipline for Your Journal</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="clearModalText()">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body mt-5">
                        <var id="result-container" class="result-container"></var>
                       <div class="typeahead__container mb-5">
                           <div class="typeahead__field">
                               <div class="typeahead__query">
                                   <input placeholder="Enter Journal Title" autocomplete="off" id="modal_journal_input">
                               </div>
                           </div>
                       </div>

                       <p id="result_message_container"></p>

                  </div>
                  <div class="modal-footer d-flex justify-content-center">
                    <a type="button" class="btn" data-dismiss="modal" onclick="findAndSetDisciplineForJournal()" style="background-color: #E57200">Use Discipline</a>
                  </div>
                </div>
              </div>
            </div>

            <p class="mb-4"><small><a href="" data-toggle="modal" data-target="#modalLoginForm">Which discipline is my journal in?</a></small></p>

            <!-- Default checked -->
            <div class="custom-control custom-switch mb-4">
              <input type="checkbox" class="custom-control-input pl-4" id="table_toggle" unchecked>
              <label class="custom-control-label" for="table_toggle">Show Data in Table</label>
            </div>

            <h4 class="mb-3">Metrics</h4>

            <div class="custom-control custom-checkbox mb-2">
              <input type="checkbox" class="custom-control-input" id="metrics_downloads" checked>
              <label class="custom-control-label" for="metrics_downloads">Downloads</label>
            </div>

            <div id="metrics_downloads_options" class="ml-4">
              <div class="custom-control custom-checkbox mb-2">
                <a id="metrics_downloads_options_recent_tooltip">
                  <input type="checkbox" class="custom-control-input" id="metrics_downloads_options_recent" checked>
                  <label class="custom-control-label" for="metrics_downloads_options_recent">Recent (JR5)</label>
                </a>
              </div>             

              <div class="custom-control custom-checkbox mb-2">
                <a id="metrics_downloads_options_alltime_tooltip">
                  <input type="checkbox" class="custom-control-input" id="metrics_downloads_options_alltime">
                  <label class="custom-control-label" for="metrics_downloads_options_alltime">All Time (JR1)</label>
                </a>
              </div>
            </div>

            <div class="custom-control custom-checkbox mb-2">
              <a id="metrics_publications_tooltip">
                <input type="checkbox" class="custom-control-input" id="metrics_publications">
                <label class="custom-control-label" for="metrics_publications">Publications by UVA Authors</label>
              </a>
            </div>

            <div class="custom-control custom-checkbox mb-2">
              <a id="metrics_citations_tooltip">
                <input type="checkbox" class="custom-control-input" id="metrics_citations">
                <label class="custom-control-label" for="metrics_citations">Citations by UVA Authors</label>
              </a>
            </div>

          </div>
          <div class="row align-items-center mb-4">
            <div class="ml-xl-3 text-center pt-3 col-xl-6">
              <button type="button" class="btn btn-sm text-white" id="metrics_show_all" style="background-color: #E57200;">Show All</button>
            </div>
            <div class="ml-xl-n5 text-center pt-3 col-xl-6">
              <button type="button" class="btn btn-sm text-white" id="metrics_hide_all" style="background-color: #E57200;">Hide All</button>
            </div>
          </div>
          
        </div>
        <div class="col-md-8">
          <!-- Downloads -->
          <div id="charts">
            <!-- Recent Downloads -->
            <div class="mt-3" id="charts_downloads_recent">
              <div id="charts_downloads_recent_chart" style="width:100%; height:475px;"></div>
            </div>
            <div class="mt-5" id="charts_downloads_alltime">
              <div id="charts_downloads_alltime_chart" style="width:100%; height:475px;"></div>
            </div>
            <div class="mt-5" id="charts_publications">
              <div id="charts_publications_chart" style="width:100%; height:475px;"></div>
            </div>

            <div class="mt-5" id="charts_citations">
              <div id="charts_citations_chart" style="width:100%; height:475px;"></div>
            </div>

          </div>
          <div id="downloads_table" class="mt-3 ml-4">
            <table id="dt-select" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>
            
          </div>

        </div>
      </div>
    </div>
  </main>
  

  <!-- jQuery -->
  <script type="text/javascript" src="{% static 'app/js/jquery.min.js' %}"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="{% static 'app/js/popper.min.js' %}"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="{% static 'app/js/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'app/js/jquery.typeahead.min.js' %}"></script>
  
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="{% static 'app/js/mdb.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'app/js/addons/datatables.min.js' %}"></script>

  <script src="https://code.highcharts.com/stock/highstock.js"></script>
  <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>  
  <!-- Your custom scripts (optional) -->
  <script type="text/javascript">

    // Tooltips Initialization
    $(function () {

      //Recent Downloads
      $("#metrics_downloads_options_recent_tooltip").tooltip( {
        html: true,
        placement: "right",
        title: "JR5 Description. <a href='#'><em>Learn More</em></a>",
        trigger: "manual" 
      });

      $("#metrics_downloads_options_recent_tooltip").on("mouseover", function() {
        $(this).tooltip("show");  
      });

      $("#metrics_downloads_options_alltime_tooltip, #metrics_publications_tooltip, #metrics_citations_tooltip").on("mouseover", function() {
        $("#metrics_downloads_options_recent_tooltip").tooltip("hide");  
      });

      $("body").on("click", function() {
        $("#metrics_downloads_options_recent_tooltip").tooltip("hide");  
      });

      // All Time Downloads
      $("#metrics_downloads_options_alltime_tooltip").tooltip( {
        html: true,
        placement: "right",
        title: "JR1 Description. <a href='#'><em>Learn More</em></a>",
        trigger: "manual" 
      });

      $("#metrics_downloads_options_alltime_tooltip").on("mouseover", function() {
        $(this).tooltip("show");  
      });

      $("#metrics_downloads_options_recent_tooltip, #metrics_publications_tooltip, #metrics_citations_tooltip").on("mouseover", function() {
        $("#metrics_downloads_options_alltime_tooltip").tooltip("hide");  
      });

      $("body").on("click", function() {
        $("#metrics_downloads_options_alltime_tooltip").tooltip("hide");  
      });

      // Publications
      $("#metrics_publications_tooltip").tooltip( {
        html: true,
        placement: "right",
        title: "Publications Description. <a href='#'><em>Learn More</em></a>",
        trigger: "manual" 
      });

      $("#metrics_publications_tooltip").on("mouseover", function() {
        $(this).tooltip("show");  
      });

      $("#metrics_downloads_options_recent_tooltip, #metrics_downloads_options_alltime_tooltip, #metrics_citations_tooltip").on("mouseover", function() {
        $("#metrics_publications_tooltip").tooltip("hide");  
      });

      $("body").on("click", function() {
        $("#metrics_publications_tooltip").tooltip("hide");  
      });

      // Citations
      $("#metrics_citations_tooltip").tooltip( {
        html: true,
        placement: "right",
        title: "Citations Description. <a href='#'><em>Learn More</em></a>",
        trigger: "manual" 
      });

      $("#metrics_citations_tooltip").on("mouseover", function() {
        $(this).tooltip("show");  
      });

      $("#metrics_downloads_options_recent_tooltip, #metrics_downloads_options_alltime_tooltip, #metrics_publications_tooltip").on("mouseover", function() {
        $("#metrics_citations_tooltip").tooltip("hide");  
      });

      $("body").on("click", function() {
        $("#metrics_citations_tooltip").tooltip("hide");  
      });
 
    });

       
    $("input[id='metrics_downloads']").on('change', function() {
      if( $(this).is(':checked') ) {
        $('#metrics_downloads_options').show();
        if( $("input[id='metrics_downloads_options_recent']").is(':checked')) {
          $('#charts_downloads_recent').show();
        }
        if( $("input[id='metrics_downloads_options_alltime']").is(':checked') ) {
          $('#charts_downloads_alltime').show();
        }
      } else {
        $('#metrics_downloads_options').hide();
        $('#charts_downloads_recent').hide();
        $('#charts_downloads_alltime').hide();
      }
    });

    $("input[id='metrics_downloads_options_recent']").on('change', function() {
      if( $("input[id='metrics_downloads']").is(':checked') && $(this).is(':checked') ) {
          $('#charts_downloads_recent').show();
      }          
      else {
        $('#charts_downloads_recent').hide();
      }    
    });
    

    $("input[id='metrics_downloads_options_alltime']").on('change', function() {
      if( $("input[id='metrics_downloads']").is(':checked') && $(this).is(':checked') ) {
          $('#charts_downloads_alltime').show();
      }          
      else {
        $('#charts_downloads_alltime').hide();
      }

  
    });

    $("input[id='metrics_publications']").on('change', function() {
      if( $(this).is(':checked') ) {
          $('#charts_publications').show();
      }          
      else {
        $('#charts_publications').hide();
      }
    });

    $("input[id='metrics_citations']").on('change', function() {
      if( $(this).is(':checked') ) {
          $('#charts_citations').show();
      }          
      else {
        $('#charts_citations').hide();
      }    
    });

    $('#metrics_show_all').on('click', function() {
      $('#charts_downloads_recent').show();
      $('#charts_downloads_alltime').show();
      $('#charts_publications').show();
      $('#charts_citations').show();

      $("#metrics_downloads_options").show();

      $("input[id='metrics_downloads']").prop('checked', true);
      $("input[id='metrics_downloads_options_recent']").prop('checked', true);
      $("input[id='metrics_downloads_options_alltime']").prop('checked', true);
      $("input[id='metrics_publications']").prop('checked', true);
      $("input[id='metrics_citations']").prop('checked', true);
    });


    $('#metrics_hide_all').on('click', function() {
      $('#charts_downloads_recent').hide();
      $('#charts_downloads_alltime').hide();
      $('#charts_publications').hide();
      $('#charts_citations').hide();

      $("#metrics_downloads_options").hide();
      $("#metrics_downloads_options_recent_types").hide();

      $("input[id='metrics_downloads']").prop('checked', false);
      $("input[id='metrics_downloads_options_recent']").prop('checked', false);
      $("input[id='metrics_downloads_options_alltime']").prop('checked', false);
      $("input[id='metrics_publications']").prop('checked', false);
      $("input[id='metrics_citations']").prop('checked', false);
    });


    function resetMetricColumnHeight() {
      $('#metrics_column').height( function() {
        var ret = 0;
        if( $(document).width() < 768) {
          heights = 0;
          $('#metrics_column').children().each( function() {
            marginTop = parseInt($(this).css("marginTop").substring(0, $(this).css("marginTop").indexOf('px')));
            marginBottom = parseInt($(this).css("marginBottom").substring(0, $(this).css("marginBottom").indexOf('px')));
            paddingTop = parseInt($(this).css("paddingTop").substring(0, $(this).css("paddingTop").indexOf('px')));
            paddingBottom = parseInt($(this).css("paddingBottom").substring(0, $(this).css("paddingBottom").indexOf('px')));
            heights = heights + marginTop + marginBottom + paddingTop + paddingBottom + $(this).height();
            // console.log($(this).attr('id') + ": " + heights);
          });
          // alert(heights);
          // console.log("Total heights: " + heights);
          // console.log("Window height: " + $(window).height());
          // console.log("Result: " + heights);

          ret =  heights + 64;
        }
        else {
          elements = ['nav', '#breadcrumb_container', '#title_description', 'hr'];
          heights = 0;
          $(elements.join(', ')).each( function() {
            marginTop = parseInt($(this).css("marginTop").substring(0, $(this).css("marginTop").indexOf('px')));
            marginBottom = parseInt($(this).css("marginBottom").substring(0, $(this).css("marginBottom").indexOf('px')));
            paddingTop = parseInt($(this).css("paddingTop").substring(0, $(this).css("paddingTop").indexOf('px')));
            paddingBottom = parseInt($(this).css("paddingBottom").substring(0, $(this).css("paddingBottom").indexOf('px')));
            heights = heights + marginTop + marginBottom + paddingTop + paddingBottom + $(this).height();
            // console.log($(this).attr('id')+ ": " + heights);
          });
          // alert(heights);
          // console.log("Total heights: " + heights);
          // console.log("Document height: " + $(document).height());
          // console.log("Result: " + ($(document).height() - heights));

          ret = $(document).height() - heights - 3 - 1;
        }

        return ret;

      });
    }


    $('#charts_downloads_alltime').hide();
    $('#charts_publications').hide();
    $('#charts_citations').hide();
    
    resetMetricColumnHeight();


    // $(document).on('click', function() {
    //   resetMetricColumnHeight();
    // });

     

    function loadDisciplinesList(disciplinesList) {
      for(var i = 0; i < disciplinesList.length; i++) {
        var newOption = document.createElement('option');
        newOption.setAttribute('value', disciplinesList[i]);
        if(i == 0) newOption.selected = true;
        newOption.innerHTML = disciplinesList[i];
        $( "#discipline_select" ).append(newOption);
        // console.log(disciplinesList[i]);
      }
    }

    $.ajax({
      url : "https://onefigrapp.herokuapp.com/app/disciplines_list/",
      // url : "http://localhost:8000/app/disciplines_list",
      dataType: "json",
      success : function (data) {
        var disciplinesList = data;
        console.log("AJAX disciplinesList");
        console.log(disciplinesList);
        loadDisciplinesList(disciplinesList); 
      }
    });

  
    

    function createDisciplineSearch(journalsAndDisciplinesMap) {
      var journalTitles = Object.keys(journalsAndDisciplinesMap);
      $.typeahead({
        input: '#modal_journal_input',
        order: "desc",
        source: {
            data: journalTitles
        },
        callback: {
          onClickAfter: function (node, a, item, event) {
              event.preventDefault();
              $('#result-container').text('');
              var text = item.display + " is in the <b>" + journalsAndDisciplinesMap[item.display] + "</b> discipline";
              console.log(item);
              console.log(text);
              $('#result_message_container').html(text);
    
          },
          onResult: function (node, query, result, resultCount) {
            if (query === "") return;

            var text = "";
            if (result.length > 0 && result.length < resultCount) {
                text = "Showing <strong>" + result.length + "</strong> of <strong>" + resultCount + '</strong> journals matching "' + query + '"';
            } else if (result.length > 0) {
                text = 'Showing <strong>' + result.length + '</strong> elements matching "' + query + '"';
            } else {
                text = 'No results matching "' + query + '"';
            }
            $('#result-container').html(text);
          }
        }
    
      });
    }

    function processViewData(dataString) {
      dataString = dataString.replace(/&amp;/g, "&");
      dataString = dataString.replace(/&quot;/g, "\"");
      // console.log(dataString);
      // Get rid of random special characters
      dataString = dataString.replace(/[^!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ\[\]^`abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿıŁłŒœŠšŸŽžƒˆˇˉ˘˙˚˛˜˝ΔΩμπ‐–—‘’‚“”„†‡•…‰‹›⁄€™Ω∂∆∏∑]/g, ''); 
      dataString = dataString.replace(/NaN/g, "0.0");
      // console.log(dataString);
      // var num = 5182;
      // if (dataString.length > num + 20) {
      //   console.log(dataString.slice(num - 20, num + 20));
      // }
      
      var dataJSON = JSON.parse(dataString);
      // console.log(dataJSON);

      return dataJSON;
    }

    var journalsAndDisciplinesMapString = "{{ journals_and_disciplines_map }}";
    var journalsAndDisciplinesMap = processViewData(journalsAndDisciplinesMapString);
    console.log(journalsAndDisciplinesMap);

    function clearModalText() {
      var title = $("#modal_journal_input").val("");
      var title = $("#result_message_container").text("");
    }

    function findAndSetDisciplineForJournal() {
      var title = $("#modal_journal_input").val();
      console.log(title);
      clearModalText();
      var discipline = journalsAndDisciplinesMap[title];
      console.log(discipline);

      var options = $('#discipline_select').children();
      if (discipline != null) {
        for (var i = 1; i < options.length; i++) {
          // console.log(options[i].value);
          if (discipline.localeCompare(options[i].value) == 0) {
            options[i].selected = true;
            break;
          }
        }
      }
      else {
        options[0].selected = true;
      }

      $("#discipline_select").change();
    }

    function removeZeroCountsAndAssociatedJournals(journals, counts) {
      var index = counts.length - 1;
      while(counts[index] == 0) {
        journals.pop();
        counts.pop();
        index++;
      }

      return [journals, counts];
    }

    
    function setChartData(config, metric, chartData, chartTitle, seriesName, yAxisTitle) {
      var rawCategories = chartData[metric].categories;
      // console.log(rawCategories);
      var rawCounts = chartData[metric].counts;
      // console.log(rawCounts);

      var categoriesAndCounts = removeZeroCountsAndAssociatedJournals([].concat(rawCategories), [].concat(rawCounts));
      // console.log(categoriesAndCounts);

      config.title.text = chartTitle;
      config.xAxis.categories = categoriesAndCounts[0];
      config.xAxis.providerMap = chartData[metric].providerMap;
      config.xAxis.percentagesMap = chartData[metric].percentagesMap;
      config.series[0].name = seriesName;
      config.series[0].data = categoriesAndCounts[1];
      config.yAxis.title.text = yAxisTitle;
      config.yAxis.max = categoriesAndCounts[1][0] * 1.05;

      return config;
    }


    function setCharts(chartData, metrics) {
      chartTitles = ['Journals by Downloads - Recent', 'Journals by Downloads - Alltime', 'Journals by Publications', 'Journals by Citations'];
      yAxisTitles = ['Number of Downloads', 'Number of Downloads', 'Number of Publications', 'Number of Citations'];
      seriesNames = ["Downloads", "Downloads", "Publications", "Citations"];
      chartIDs = ['charts_downloads_recent_chart', 'charts_downloads_alltime_chart', 'charts_publications_chart', 'charts_citations_chart'];

      var chartConfig = {
          chart: {
              type: 'bar'
          },
          title: {
              fontFamily: 'Segoe UI',
              style: {
                fontWeight: 10,
                fontSize: 20,
              }
          },
          tooltip: {
              formatter: function() {
                  var s = '<small>'+ this.x + '</small>';

                  $.each(this.points, function(i, point) {
                      s += '<br/>'+ point.series.name +': '+ '<b>' + point.y + '</b>' + ' (' + chartConfig.xAxis.percentagesMap[this.x] + '% of All ' + point.series.name + ')';
                  });

                  s += '<br/>' + 'Provider: ' + chartConfig.xAxis.providerMap[this.x];

                  return s;
              },
              shared: true,
              useHTML: false
          },
          xAxis: {
              providerMap: {},
              percentagesMap: {},
              min: 0,
              max: 15,
              scrollbar: {
                  enabled: true
              },
              tickLength: 0
          },
          yAxis: {
              title: {
                  
              },
              min: 0,
          },
          legend: {
              enabled: false
          },
          series: [{
              
          }],
          credits: {
              enabled: false
          },
      };

      
      $.each(chartTitles, function (i, item) {

        

        var config = setChartData(chartConfig, metrics[i], chartData, chartTitles[i], seriesNames[i], yAxisTitles[i])

        Highcharts.chart(chartIDs[i], config);
      }); 
        

    }
    var metrics = ['Downloads JR5 2017 in 2017', 'Downloads JR1 2017', 'References', 'Papers'];

    function rotate(matrix) {          // function statement        
        var output = [];

        for(var col = 0; col < matrix[0].length; col++){
          var newArr = [];
          for(var rowIndex = 0; rowIndex < matrix.length; rowIndex++){
            newArr.push(matrix[rowIndex][col]);  
          }

          output.push(newArr); 
          
        }
          
        return output;

        // [1, 3, 7],           [1, 5],
        // [5, 9, 4] turns into [3, 9],
        //                      [7, 4]


    }

    function setTable(chartData, metrics) {
      var categories = chartData[metrics[0]].categories;
      /*
      console.log(categories);
      console.log(categories.length);
      console.log(chartData[metrics[0]].counts.length);
      console.log(chartData[metrics[1]].categories.length);
      console.log(chartData[metrics[1]].counts.length);
      console.log(chartData[metrics[2]].categories.length);
      console.log(chartData[metrics[2]].counts.length);
      console.log(chartData[metrics[3]].categories.length);
      console.log(chartData[metrics[3]].counts.length);
      */
      var tableCounts = [];
      tableCounts.push(categories);
      
      var numDownloadsPasses = 0;
      for(var i = 0; i < metrics.length; i++){
        var newArr = [];
        if( i == 0 && numDownloadsPasses == 1 ) {
          for(var j = 0; j < categories.length; j++) {
            count = chartData[metrics[i]].percentagesMap[categories[j]];
            newArr.push(count);
          }
        }
        for(var j = 0; j < categories.length; j++) {
          var index = chartData[metrics[i]].categories.indexOf(categories[j]);
          var count = 0; 
          if(index != -1) {
            count = chartData[metrics[i]].counts[index];
          }
          newArr.push(count);
        }
        tableCounts.push(newArr);
        if( i == 0 && numDownloadsPasses == 0 ) {
          i--;
          numDownloadsPasses++;
        }
      }  
      console.log(tableCounts);    

      // trClasses = ["journal-title-column", "recent-column", "alltime-column", "publications-column", "citations-column"]
      var tableData = rotate(tableCounts);
      console.log("TABLE DATA");
      // console.log(tableData)
      /*
      var tableBody = document.getElementById('table_body');
      tableBody.innerHTML = "";
      for(var i = 0; i < tableData.length; i++) {
        var row = document.createElement('tr');
        for(var j = 0; j < tableData[i].length; j++) {
          var dataPoint = document.createElement('td');
          dataPoint.innerHTML = tableData[i][j];
          dataPoint.classList.add(trClasses[j]);
          row.appendChild(dataPoint);
        }
        tableBody.appendChild(row);
      }
      */
      if ( $.fn.dataTable.isDataTable( '#dt-select' ) ) {
        // alert("Already Created");
          var table = $('#dt-select').DataTable();
          table.clear();
          table.rows.add( tableData ).draw();
      }
      else {
        // alert("New Table");
        var table = $('#dt-select').DataTable( {
            data: tableData,
            columns: [
                { title: "Title" },
                { title: "Recent (JR5) (Count)" },
                { title: "Recent (JR5) (Percent)" },
                { title: "All Time (JR1)" },
                { title: "Publications" },
                { title: "Citations" },
            ]
        } );
      }
      
    }

    

    $(document).ready(function () {
      $.ajax({
        url : "https://onefigrapp.herokuapp.com/app/chart_data/Architecture/",
        // url : "http://localhost:8000/app/chart_data/Architecture/",
        dataType: "json",
        success : function (data) {
          chartData = data;
          console.log(chartData);
          setCharts(chartData, metrics);
          setTable(chartData, metrics);
          
        }
      });

      $('#downloads_table').hide();

      $.ajax({
        url : "https://onefigrapp.herokuapp.com/app/journals_and_disciplines_map/",
        // url : "http://localhost:8000/app/journals_and_disciplines_map/",
        dataType: "json",
        success : function (data) {
          createDisciplineSearch(data);
          
        }
      });
    });



    $("#discipline_select").on("change", function() {
        // console.log($("#discipline_select").val());
        // console.log(typeof($("#discipline_select").val()));
        if( $("#discipline_select").val() != $("#discipline_select").children().first().val() ) {
          // var queryURL = "http://localhost:8000/app/chart_data/" + encodeURI($("#discipline_select").val()) + "/";
          var queryURL = "https://onefigrapp.herokuapp.com/app/chart_data/" + encodeURI($("#discipline_select").val()) + "/"
          console.log(queryURL);
          $.ajax({
            url : queryURL,
            dataType: "json",
            success : function (data) {
              chartData = data;
              console.log(chartData);
              setCharts(chartData, metrics);
              setTable(chartData, metrics);
              
            }
          });
          
        }
    });

    // var downloadsChecked = $("input[id='metrics_downloads']").is(':checked');
    // console.log(downloadsChecked);
    // var recentChecked = $("input[id='metrics_downloads_options_recent']").is(':checked');
    // console.log(recentChecked);
    // var alltimeChecked = $("input[id='metrics_downloads_options_alltime']").is(':checked');
    // console.log(alltimeChecked);
    // var publicationsChecked = $("input[id='metrics_publications']").is(':checked');
    // console.log(publicationsChecked);
    // var citationsChecked = $("input[id='metrics_citations']").is(':checked');
    // console.log(citationsChecked);

    $("input[id='table_toggle']").on('change', function() {
      if( $(this).is(':checked') ) {
        $("#charts").hide();
        $("#downloads_table").show();

        $('#downloads-checked').text($("input[id='metrics_downloads']").is(':checked'));
        $('#recent-checked').text($("input[id='metrics_downloads_options_recent']").is(':checked'));
        $('#alltime-checked').text($("input[id='metrics_downloads_options_alltime']").is(':checked'));
        $('#publications-checked').text($("input[id='metrics_publications']").is(':checked'));
        $('#citations-checked').text($("input[id='metrics_citations']").is(':checked'));

        $('#downloads-checked').hide();
        $('#recent-checked').hide();
        $('#alltime-checked').hide();
        $('#publications-checked').hide();
        $('#citations-checked').hide();

        $("input[id='metrics_downloads']").prop('checked', true);
        $("input[id='metrics_downloads_options_recent']").prop('checked', true);
        $("input[id='metrics_downloads_options_alltime']").prop('checked', true);
        $("input[id='metrics_publications']").prop('checked', true);
        $("input[id='metrics_citations']").prop('checked', true);

        $("input[id='metrics_downloads']").prop('disabled', true);
        $("input[id='metrics_downloads_options_recent']").prop('disabled', true);
        $("input[id='metrics_downloads_options_alltime']").prop('disabled', true);
        $("input[id='metrics_publications']").prop('disabled', true);
        $("input[id='metrics_citations']").prop('disabled', true);
      }
      else {
        $("#charts").show();
        $("#downloads_table").hide(); 

        $("input[id='metrics_downloads']").prop('checked', ($('#downloads-checked')[0].innerHTML == 'true'));
        // console.log($('#downloads-checked')[0].innerHTML);
        $("input[id='metrics_downloads_options_recent']").prop('checked', ($('#recent-checked')[0].innerHTML == 'true'));
        // console.log($('#recent-checked')[0].innerHTML);
        $("input[id='metrics_downloads_options_alltime']").prop('checked', ($('#alltime-checked')[0].innerHTML == 'true'));
        // console.log($('#alltime-checked')[0].innerHTML);
        $("input[id='metrics_publications']").prop('checked', ($('#publications-checked')[0].innerHTML == 'true'));
        // console.log($('#publications-checked')[0].innerHTML);
        $("input[id='metrics_citations']").prop('checked', ($('#citations-checked')[0].innerHTML == 'true'));
        // console.log($('#citations-checked')[0].innerHTML);

        $("input[id='metrics_downloads']").prop('disabled', false);
        $("input[id='metrics_downloads_options_recent']").prop('disabled', false);
        $("input[id='metrics_downloads_options_alltime']").prop('disabled', false);
        $("input[id='metrics_publications']").prop('disabled', false);
        $("input[id='metrics_citations']").prop('disabled', false); 
      }
    });





  </script>

</body>
</html>
